{% extends 'wadmin/frame.html' %}
{% block ext_header %}
    <script src="{{ STATIC_URL }}wadmin/js/change_list.js"></script>
    <script>
        function save_programme_sort(value) {
            $.ajax({
                type: 'POST',
                url: "{% url 'wadmin:sort_programme' %}",
                data: {'value': value}
            });
        }
        $(function () {
            var tbody = $('tbody');
            tbody.sortable({
                connectWith: "tbody",
                forcePlaceholderSize: true,
                cursor: "move",
                cancel: ".unsort, .tab-content",
                stop: function (event, ui) {
                    var ids = [];
                    $("tbody").find("input[type=checkbox]").each(function () {
                        ids.push($(this).val());
                    });
                    save_programme_sort(ids.join(','));
                }
            });
            tbody.disableSelection();
        });

    </script>
    <style>
        tbody tr {
            cursor: ns-resize;
        }
    </style>
{% endblock %}
{% block content %}
    <form action="" method="post" xmlns="http://www.w3.org/1999/html">
        <div class="panel">
            <div class="panel-body">
                <div class="btn-group">
                    <button name="delete" class="btn btn-danger"><span
                            class="glyphicon glyphicon-trash"></span>删除所选
                    </button>
                    <a href="{% url 'wadmin:programme_edit' '' %}{{ view.get_query_string }}"
                       class="btn btn-primary"><span
                            class="glyphicon glyphicon-plus"></span>添加</a>
                </div>
            </div>
        </div>
        <nav>
            <ul class="pagination">
                {% for page in page_range %}
                    {{ page }}
                {% endfor %}
            </ul>
        </nav>
        <div class="table-responsive">
            <div class="help-block">
                拖动可修改节目次序
            </div>
            <table class="table table-striped table-bordered table-hover" id="object_table">
                <thead>
                <tr>
                    <th scope="col" style="width: 12px"><input type="checkbox"></th>
                    <th scope="col">名称</th>
                    <th scope="col">节目样式</th>
                    <th scope="col">二维码</th>
                    <th scope="col">&nbsp;</th>

                </tr>
                </thead>
                <tbody>
                {% for object in object_list %}
                    <tr>
                        <td scope="col" style="width: 12px"><input name="id" value="{{ object.pk }}" type="checkbox">
                        </td>
                        <td><a href="{% url 'wadmin:programme_edit' object.pk %}{{ view.get_query_string }}">
                            {{ object.name }}
                        </a>
                        </td>
                        <td>{{ object.template }}</td>
                        <td>{% if object.qrcode_url %}
                            <img width="100" height="100" src="{{ object.qrcode_url }}"> {% endif %}</td>
                        <td>{% ifequal object.template.type.value 'vote' %}
                            <a href="{% url 'wadmin:vote_list' %}?__parent={{ object.pk }}"
                               class="btn btn-default">管理投票</a>{% endifequal %}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        {% include 'wadmin/inclute/change_list_delete_confirm.html' %}
    </form>
    <nav>
        <ul class="pagination">
            {% for page in page_range %}
                {{ page }}
            {% endfor %}
        </ul>
    </nav>
{% endblock %}